language: python

python:
    - 2.7

sudo: false

warnings_are_errors: false

addons:
  apt:
    packages:
      - unixodbc-dev

notifications:
  email:
    on_success: change
    on_failure: change
    
env:
  global:
    - secure: EXAHOST=213.95.157.21:8563 EXAUSER=PUB1351 EXAPW=pbFKDM9g3
    - secure: ODBC_HOST=213.95.157.21:8563 ODBC_DRIVER=$HOME/EXASOL_ODBC-6.0.2/lib/linux/x86_64/libexaodbc-uo2214lv2.so
    - EXAODBC=EXASOL_ODBC-6.0.2
    - EXAODBC_URL=https://www.exasol.com/support/secure/attachment/52896/
    - ODBCINI=$HOME/odbc.ini
    - ODBCSYSINI=$HOME
    #https://www.exasol.com/support/secure/attachment/52896/EXASOL_ODBC-6.0.2.tar.gz

before_install:

    # move odbcinst.ini to home
    - cp tests/odbcinst.ini $HOME
    
    # get unixODBC
    - wget www.unixodbc.org/unixODBC-2.3.4.tar.gz
    
    # get EXAODBC    
    - wget $EXAODBC_URL$EXAODBC".tar.gz"

    # get conda
    #- wget https://repo.continuum.io/miniconda/Miniconda2-latest-Linux-x86_64.sh

   
install:
    - pip install pyodbc
    - pip install pandas
    
    # install unixodbc
    - tar -xzf unixODBC-2.3.4.tar.gz
    - ./unixODBC-2.3.4/configure --prefix=$HOME/unixodbc
    - make
    - make install
    
    # install EXAODBC
    - tar -xzf $EXAODBC".tar.gz"
    - ./$EXAODBC/config_odbc --mode=config --host=$EXAHOST --user=$EXAUSER --password=$EXAPW
    
    #install conda und pandas
    #- conda create -n conda_env python
    #- source active conda_env
    #- bash Miniconda2-latest-Linux-x86_64.sh -b -p $HOME/miniconda
    #- conda install pandas 
    
    # install py sdk
    - python setup.py install --prefix=$HOME/exa_py

script:
    #- PYTHONPATH=$HOME/exa_py/lib/python2.7/site-packages python tests/test.py 
    - PYTHONPATH=$HOME/exa_py/lib/python2.7/site-packages python tests/selftest.py
    - PYTHONPATH=$HOME/exa_py/lib/python2.7/site-packages python tests/data_exchange.py
    #- PYTHONPATH=$HOME/exa_py/lib/python2.7/site-packages python tests/udf_sdk.py
    #- ./tests/pylint.sh
